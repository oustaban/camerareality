<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="viewport" content="width=device-width">
</head>
<body>
<div class="app">
            <h1>Apache Cordova</h1>
            <div id="deviceready" class="blink">
                <p class="event listening">Connecting to Device</p>
                <p class="event received">Device is Ready</p>
            </div>

            <h2> Camera Position </h2>
            <input type="radio" name="deviceposition" id="deviceposition_back" value="Back" onclick="onChangeDevicePosition();"/>
            <label for="deviceposition_back">Back</label>
            <br/>
            <input type="radio" name="deviceposition" id="deviceposition_front" value="Front" onclick="onChangeDevicePosition();"/>
            <label for="deviceposition_front">Front</label>


            <h2> Flash Mode </h2>
            <input type="radio" name="flashmode" id="flashmode_off" value="Off" onclick="onChangeFlashMode();"/>
            <label for="flashmode_off">Off</label>
            <br/>
            <input type="radio" name="flashmode" id="flashmode_on" value="On" onclick="onChangeFlashMode();"/>
            <label for="flashmode_on">On</label>
            <br/>
            <input type="radio" name="flashmode" id="flashmode_auto" value="Auto" onclick="onChangeFlashMode();"/>
            <label for="flashmode_auto">Auto</label>
            <br/>

            <input type="button" value="Take a picture" onclick="onTakePicture();" />


        </div>

    <!— camera preview canvas —>
        <div id="layer" style="position:relative">
        <canvas style="position:absolute; top:0px; left:0px" id="camera" width="352" height="288" style="border:2px"></canvas>
        <img src="img/arrowleft.png" style="position:absolute; top:100px; left: 100px; z-index:10" />
        <div id="info" style="position:absolute; top:100px; left: 200px; width:100px; height:20px; color:#000000; z-index:12"></div>
        <div id="info2" style="position:absolute; top:200px; left: 200px; width:100px; height:20px; color:#000000; z-index:13"></div>
        <div id="info3" style="position:absolute; top:300px; left: 200px; width:100px; height:20px; color:#000000; z-index:14"></div>
        </div>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>

        <script>
            document.addEventListener("deviceready", function() {
                        canvasMain = document.getElementById("camera");
                        CanvasCamera.initialize(canvasMain);
                        // define options
                        var opt = {
                            quality: 75,
                            destinationType: CanvasCamera.DestinationType.DATA_URL,
                            encodingType: CanvasCamera.EncodingType.JPEG,
                            saveToPhotoAlbum:true,
                            correctOrientation:true,
                            width:640,
                            height:480
                        };
                        CanvasCamera.start(opt);
                        
                         
                        var options = {
                              frequency: 300
                        };
                        var watchID = navigator.compass.watchHeading(onSuccess, onError, options);
                       
            });

            function onChangeDevicePosition() {

                var newDevicePosition = CanvasCamera.CameraPosition.BACK;
                if (document.getElementById("deviceposition_back").checked)
                {
                    newDevicePosition = CanvasCamera.CameraPosition.BACK;
                }
                else if (document.getElementById("deviceposition_front").checked)
                {
                    newDevicePosition = CanvasCamera.CameraPosition.FRONT;
                }
                //
                CanvasCamera.setCameraPosition(newDevicePosition);
                
                var optionsAcc = { frequency: 300 };  // Update every 3 seconds

                        var watchID2 = navigator.accelerometer.watchAcceleration(onAccSuccess, onAccError, optionsAcc);
                        
                        var optionsGeo = { frequency: 300, enableHighAccuracy: true };  // Update every 3 seconds

                        var watchID3 = navigator.geolocation.watchPosition(onGpsSuccess, onGpsError, optionsGeo);

                        
                                          
            }

            function onChangeFlashMode() {

                var newFlashMode = CanvasCamera.FlashMode.OFF;
                if (document.getElementById("flashmode_off").checked)
                {
                    newFlashMode = CanvasCamera.FlashMode.OFF;
                }
                else if (document.getElementById("flashmode_on").checked)
                {
                    newFlashMode = CanvasCamera.FlashMode.ON;
                }
                else if (document.getElementById("flashmode_auto").checked)
                {
                    newFlashMode = CanvasCamera.FlashMode.AUTO;
                }

                CanvasCamera.setFlashMode(newFlashMode);
            }

            function onTakePicture() {
                CanvasCamera.takePicture(onTakeSuccess);
            }

            function onTakeSuccess(data) {
                //
            }
            
            function onSuccess(heading) {
                var element = document.getElementById('info') ;
                element.innerHTML = "Compass:" + heading.magneticHeading +'/' + heading.trueHeading ;
            };
            
            
            
            function onAccSuccess(acceleration) {
                        var element = document.getElementById('info2') ;
                        element.innerHTML = "Accelorometer:" + acceleration.x + "/" + acceleration.y + "/" + acceleration.z + "/" + acceleration.timestamp
            };
            
            function onGpsSuccess(position) {
                        var element = document.getElementById('info3');
                        element.innerHTML = 'GPS: '  + position.coords.latitude + '/' + position.coords.longitude + '/' + position.coords.altitude + '/' + position.coords.accuracy + '/' + position.coords.altitudeAccuracy + '/' + position.coords.heading + '/' + position.coords.speed + '/' + position.timestamp;
                        
            }
            
            function onError(compassError) {
                console.log(' erreur de boussole: '+ compassError.code);
            }
            
            function onAccError(error) {
                        alert('code: '    + error.code    + '\n' + 'message: ' + error.message + '\n');
            }

        
            function onGpsError(error) {
                        alert('code: '    + error.code    + '\n' + 'message: ' + error.message + '\n');
            }

            
        </script>

</body>
</html>
